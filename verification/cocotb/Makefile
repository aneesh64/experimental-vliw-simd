# Makefile for cocotb simulation of VLIW SIMD SoC
#
# Prerequisites:
#   - Verilator or Icarus Verilog installed
#   - cocotb installed: pip install cocotb
#   - Generated Verilog: sbt "runMain vliw.gen.GenerateSim"
#
# Usage:
#   make                     # run all tests with Verilator
#   make SIM=icarus           # run with Icarus Verilog
#   make TESTCASE=test_csr_readback  # run a specific test

TOPLEVEL_LANG = verilog

# Simulator: verilator (default) or icarus
SIM ?= verilator

# Top-level module name (generated by SpinalHDL)
TOPLEVEL = VliwSimdSoc_1c

# Python test module
MODULE = test_smoke

# Path to generated Verilog
VERILOG_DIR = ../../generated_rtl/Sim

# Source files (main + any sub-modules SpinalHDL generates)
VERILOG_SOURCES = $(wildcard $(VERILOG_DIR)/*.v)

# Verilator-specific flags
ifeq ($(SIM),verilator)
    EXTRA_ARGS += --trace --trace-structs
    COMPILE_ARGS += -Wno-WIDTHTRUNC -Wno-WIDTHEXPAND -Wno-UNOPTFLAT -Wno-UNSIGNED
endif

# cocotb Makefile include
include $(shell cocotb-config --makefiles)/Makefile.sim
